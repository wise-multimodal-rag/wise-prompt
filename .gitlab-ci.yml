stages:
  - secret_detection
  - lint
  - test
  - build-and-push-app
  - container_test
  - triage-dry-run
  - triage-run

include:
  - local: '.gitlab/ci/Secret-Detection.gitlab-ci.yml'
  - local: '.gitlab/ci/Dependency-Management.gitlab-ci.yml'
  - local: '.gitlab/ci/Lint.gitlab-ci.yml'
  - local: '.gitlab/ci/Test.gitlab-ci.yml'
  - local: '.gitlab/ci/Build-and-Push-App.gitlab-ci.yml'
  - local: '.gitlab/ci/Container-Scanning.gitlab-ci.yml'
  - component: $CI_SERVER_FQDN/components/gitlab-triage/gitlab-triage@0.1.2
    inputs:
      stage: triage-dry-run
      api_token: $API_TOKEN   # $API_TOKEN bot 실행을 위한 Access Token 이름
      debug: true
      dry_run: true
      helpers_file: ./.gitlab/helpers.rb
      job_suffix: ':dry-run'
    rules:
      - if: $CI_PIPELINE_SOURCE != "schedule"
  - component: $CI_SERVER_FQDN/components/gitlab-triage/gitlab-triage@0.1.2
    inputs:
      stage: triage-run
      api_token: $API_TOKEN
      debug: true
      helpers_file: ./.gitlab/helpers.rb
      job_suffix: ':schedule'
    rules:
      - if: $CI_PIPELINE_SOURCE == "schedule"
